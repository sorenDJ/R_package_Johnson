---
title: "Project Two"
output: html_document
---
## Due Nov. 12 at Midnight.
## Complete this activity in your R_package_lastname project.

Please have a look at [this](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/1365-2656.12373) paper. It explains the relationship between air temperature, butterfly emergence, and plant flowering.


##  Phenology 

Phenology is the study of when events happen in organisms' life cycles. For example, the first flowering of a plant for the year, or the emergence of forager bees. Typically, organisms take cues from their environment. Commonly, these are changes such as photoperiod (how much light there is per day) or temperature. 

When organisms that rely on one another fall out of sync, it can be a problem. For example, if a plant starts to flower when the soil is warm enough, this will often occur after a period of warmer air temperatures because soil has a higher heat capacity than air. What happens to the bees when they emerge and don't find any food? This is called *ecological mismatch*. Originally described in 2004 by Winder and Schindler, ecological mismatch can mean that one or both species don't have their needs met by the environment. 

What we're going to do today is look at some historical and present-day ecological data. What were the temperatures historically? And when did butterflies erupt from their cocoons? Butterflies need to be warm to incubate, exit the coccoon and go into flight. 

Before trying the test, make sure you've read the Kharouba and Vellend paper and understand the hypotheses they were testing.

# Project Two

## Part One. 55 points.

```{r}
download.file(url = "https://raw.githubusercontent.com/Paleantology/GBIO153H/master/data/Butterfly_data.csv", destfile = "/cloud/project/data/Butterfly_data.csv")
download.file(url = "https://raw.githubusercontent.com/Paleantology/GBIO153H/master/data/Phenology_data.csv", destfile = "/cloud/project/data/Phenology_data.csv")
```

## Next, let's read in both the butterfly and phenology datasets. 5 pts.

```{r}
# Code
butterfly_data <- read_csv("/cloud/project/data/Butterfly_data.csv")
Phenology_data <- read_csv("/cloud/project/data/Phenology_data.csv")
```


1) How many unique species of butterly are in the dataset? (5pts)


```{r, eval=FALSE}
butterfly_data %>% 
  distinct(ButterflySpecies)

#12 unique species
```

2) Check out the relationship between temperature and time. First, let's plot it. Choose an approriate plot type, and plot the year vs. temperature. (5 pts)
```{r, eval = FALSE}
# Code
ggplot(data = Phenology_data, mapping = aes(x = Year, y = AnnualTemp)) + geom_point()
```


3. It looks like there might be a relationship between these two things. We'll check this with a *linear regression*. Use `stat_smooth` to add a regression to the plot. (5 pts)


```{r, eval = FALSE}
#Code
ggplot(data = Phenology_data, mapping = aes(x = Year, y = AnnualTemp)) + geom_point() + stat_smooth(method = "lm", fill = "deeppink4")
```

## Let's take a look at the actual butterflies.

4) If butterflies emerge based on temperature, what would we expect to be the relationship between Spring temperature and day of emergence? Summer temperature and day of emergence? Year and day? Test all three out below. Which predictor (day, spring temp, summer temp) you think is most relevant? (10 points)

I expect an inverse relationship between Spring temp and day of emergence as well as for Summer temp. With increasing temps throughout years I would expect a negative relation between year and day as well.

```{r, eval=FALSE}
#Code
ggplot(data = butterfly_data, mapping = aes(x = SpringTemp, y = Day)) + geom_point() + geom_smooth(method = "lm")
spring_temp_model <- lm(Day ~ SpringTemp, data = butterfly_data)
summary(spring_temp_model)

ggplot(data = butterfly_data, mapping = aes(x = SummerTemp, y = Day)) + geom_point() + geom_smooth(method = "lm")
summer_temp_model <- lm(Day ~ SummerTemp, data = butterfly_data)
summary(summer_temp_model)

ggplot(data = butterfly_data, mapping = aes(x = Year, y = Day)) + geom_point() + geom_smooth(method = "lm")
year_model <- lm(Day ~ Year, data = butterfly_data)
summary(year_model)

#based on the above I would believe spring temp is the most relevant because it has the highest R^2 value. The paper though found the summer temp to have the best relationship with day of emergence.
```

5) Is there a significant linear relationship between any predictors and the response? (10 pts)

```{r}
# code here
summary(spring_temp_model)
summary(summer_temp_model)
summary(year_model)


```

```
#Answer here
Both the spring and summer temp models have significant relationships based on the p-value. The residual errors though are relatively high.
```
```

6) It looks like different animals might have different relationships to the predictor variables. Try plotting them out as a facets (5 pts).


```{r, eval=FALSE}
#Code
ggplot(data = butterfly_data, mapping = aes(x = SpringTemp, y = Day)) + geom_point() + facet_wrap(facets = vars(ButterflySpecies))

ggplot(data = butterfly_data, mapping = aes(x = SummerTemp, y = Day)) + geom_point() + facet_wrap(facets = vars(ButterflySpecies))

ggplot(data = butterfly_data, mapping = aes(x = Year, y = Day)) + geom_point() + facet_wrap(facets = vars(ButterflySpecies))
```

7) Join our two datasets together and remake the facet plot above. Does this change your opinion of the relatedness of variables? (5 pts)

There still appears to be a negative relationship with some species but not others. Specifically P. zelicaon and Plebejus icariodes look to have a negative relationship with annual temp and spring temp. Overall though this does not have a large impact on how I view the relatedness of the variables. The annual temp does have a slightly more negative relationship for some of the species of butterflies.
```{r}
#Code
joined_data <- butterfly_data %>% 
+ inner_join(Phenology_data, by = c("Year"))

ggplot(data = joined_data, mapping = aes(x = AnnualTemp, y = Day)) + geom_point() + facet_wrap(facets = vars(ButterflySpecies))
```

8) Wrap up: What is the relationship between temperature (remember that we looked at 3 kinds of temperature) and day of emergence? Is it the same for all species? How does this relate back to Kharouba and Vellend's hypotheses? (10 pts)

There appears to be the strongest relationship with day of emmergence and spring temperature but this relationship does not appear to be very strong. This relationship is also dependent on the species of butterfly. Some butterfly species appear to be more greatly impacted by spring temp than others. P. zelicaon and P. icarioides have a negative relationship while C. tullia appears to have a slight positive relationship. Kharouba and Vellend hypothesized that there would be phenology shitfs in butterfly emergence based on changing temperatures. They also hypothesized that different species would have different sensitivties to temperature change, which was found in this analyzed data. One difference is that they found summer temp to be better predictor of the emergence of butterflies than spring temp.
```{r}
#Answer here.
butterfly_model <- lm(Day ~ SpringTemp + SummerTemp + AnnualTemp + ButterflySpecies, data = joined_data)

summary(butterfly_model)
```

# Part Two. 30 points.

For each of your function files, add to the .R:

+ Expected function inputs. For example, if you will be plotting a histogram, do you want a data frame as input? A dataframe and the name of the column you want to plot? 
+ Expected outputs. Will your function return a plot? A single number? A vector of numbers? 

# Part Three. 15 points

Add, commit, and push this file to your R_Package_LastName GitHub repo. Place this file in vignettes. Place the data in data/.
